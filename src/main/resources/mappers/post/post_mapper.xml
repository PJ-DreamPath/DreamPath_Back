<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.korit.dreampath_back.mapper.PostMapper">
    <resultMap id="postResultMap" type="com.korit.dreampath_back.entity.Post">
        <id property="postId" column="post_id"/>
        <result property="boardId" column="board_id"/>
        <result property="userId" column="user_id"/>
        <result property="mentoringCategoryId" column="mentoring_category_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="starPoint" column="star_point"/>
        <result property="mentoringAddress" column="mentoring_address"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="status" column="status"/>
        <result property="createAt" column="create_at"/>
        <result property="updateAt" column="update_at"/>
        <result property="viewCount" column="view_count"/>
    </resultMap>

    <select id="selectPostList" resultType="com.korit.dreampath_back.entity.Post">
        select
            post_id
            board_id
            user_id
            mentoring_category_id
            title
            content
            star_point
            mentoring_address
            start_date
            end_date
            status
            create_at
            update_at
            view_count
        from
            post_tb
        <where>
            board_id = #{boardId}
            <if test="searchTxt != null and searchTxt != ''">
                and title like concat("%", #{searchTxt} , "%")
            </if>
            <if test="order != null and order == 'recruiting'">
                and status = "recruiting"
            </if>
            <if test="order != null and order == 'closedRecruitment'">
                and status = "closedRecruitment"
            </if>
        </where>
        order by
            <choose>
                <when test="order == 'asc'">
                    postId asc,
                </when>
                <when test="order == 'countDesc'">
                    viewCount desc,
                </when>
                <when test="order == 'countAcs'">
                    viewCount asc,
                </when>
                <when test="order == 'likeDesc'">
                    likeCount desc,
                </when>
                <when test="order == 'likeAcs'">
                    likeCount asc
                </when>
            </choose>
            postId desc
        limit #{startIdx}, #{limitCount}
    </select>
</mapper>